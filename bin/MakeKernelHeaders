#!/bin/sh

TOP_DIR=..

version="$1"
kernel_arch="$2"
dest_dir="$3/$1"

echo "Downloading the Linux-Libc-Headers script..."
pushd "$TOP_DIR/downloads" >& /dev/null
rm -f headers
wget --quiet http://ftp.jg555.com/headers/headers
GrepReplace "\--quiet" "" headers && rm -f headers~
chmod +x headers
./headers "$version"
popd >& /dev/null

echo "Configuring headers for chosen platform ($kernel_arch)..."
pushd linux-headers-$version/include >& /dev/null
for i in asm-*
do
    [ "$i" = "asm-$kernel_arch" -o "$i" = "asm-generic" ] && continue
    rm -Rf "$i"
done
ln -nfs asm-$kernel_arch asm
popd >& /dev/null


echo "Installing headers on $dest_dir..."
mkdir -p $dest_dir
mv linux-headers-$version/* $dest_dir

pushd $dest_dir/.. >& /dev/null
rm -f Current
ln -s $version Current
popd >& /dev/null

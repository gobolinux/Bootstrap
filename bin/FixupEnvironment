#!/bin/sh

#
# After the system is cross-compiled, ensure that we have a sane
# environment ready to be used.
# 
# Author: Lucas Correia Villa Real <lucasvr@gobolinux.org>
#

TOP_DIR=..

source ScriptFunctions
source $TOP_DIR/.config

if [ "$CROSS_NONE" = "y" ]
then 
	# nothing to do
	exit 0
else
	[ "$CROSS_ARM"  = "y" ] && arch_conf=ARM
	[ "$CROSS_SH4"  = "y" ] && arch_conf=SH4
	
	source $goboSettings/Compile/Cross-$arch_conf.conf
	prefix="$crossPrefixDir"
fi


#
# Create a new ld.so.conf
#
if [ -d "$prefix/$goboPrograms/Glibc/Settings" ]
then
	echo "$prefix/$goboLibraries" > "$prefix/$goboPrograms/Glibc/Settings/ld.so.conf"
	ldconfig -f "$prefix/$goboPrograms/Glibc/Settings/ld.so.conf" \
    	     -C "$prefix/$goboPrograms/Glibc/Settings/ld.so.cache"
	ln -s "$prefix/$goboPrograms/Glibc/Settings/ld.so.conf"  "$prefix/$goboSettings"
	ln -s "$prefix/$goboPrograms/Glibc/Settings/ld.so.cache" "$prefix/$goboSettings"
fi

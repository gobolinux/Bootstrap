#!/bin/sh

TOPDIR=..

source GoboPath
source ScriptFunctions
source $TOPDIR/.config
source $TOPDIR/functions/Platforms

if [ "$NATIVE_COMPILING" = "y" ]
then export arch_conf="Native"
else export arch_conf=`get_chosen_arch`
fi
        
eval `grep cross_prefix_dir= $goboSettings/Compile/Cross/Cross-$arch_conf.conf`
prefix="$cross_prefix_dir"

case "$1" in
    [sS]tart)
        mkdir -p $prefix/$goboStatus $prefix/$goboDevices
        [ ! -e $prefix/$goboStatus/self ]  && mount -o bind $goboStatus  $prefix/$goboStatus
        [ ! -e $prefix/$goboDevices/kmem ] && mount -o bind $goboDevices $prefix/$goboDevices
        ;;
    [sS]top)
        unset failed
        mount | grep "$prefix/$goboStatus"  && { umount $prefix/$goboStatus  || failed=yes; }
        mount | grep "$prefix/$goboDevices" && { umount $prefix/$goboDevices || failed=yes; }
        if [ "$NATIVE_COMPILING" != "y" ]
        then
            [ "$failed" ] && Die "Skipping removal of $TOPDIR/chroot/Area-*"
            rm -Rf $TOPDIR/chroot/Area-*
        fi
        ;;
esac

true

#!/bin/sh

TOPDIR=..

source GoboPath
source ScriptFunctions
source $TOPDIR/.config
source $TOPDIR/functions/Platforms

if [ "$NATIVE_COMPILING" = "y" ]
then export arch_conf="Native"
else export arch_conf=`get_chosen_arch`
fi
        
eval `grep cross_prefix_dir= $goboSettings/Compile/Cross/Cross-$arch_conf.conf`
prefix="$cross_prefix_dir"

case "$1" in
    [sS]tart)
        mkdir -p $prefix/$goboStatus $prefix/$goboDevices
        [ ! -e $prefix/$goboStatus/self ]  && mount -o bind $goboStatus  $prefix/$goboStatus
        [ ! -e $prefix/$goboDevices/kmem ] && mount -o bind $goboDevices $prefix/$goboDevices
        ;;
    [sS]top)
        umount $prefix/$goboStatus 2> /dev/null     && echo "Unmounted binded proc filesystem"
        umount $prefix/$goboDevices 2> /dev/null    && echo "Unmounted binded dev filesystem"
        [ "$NATIVE_COMPILING" != "y" ] && rm -Rf $TOPDIR/chroot/Area-*
        ;;
esac

true

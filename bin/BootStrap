#!/bin/sh

TOPDIR=..

source GoboPath
source ScriptFunctions
source $TOPDIR/.config

if [ "$CROSS_NONE" = "y" ]
then 
    prefix="$INSTALL_PREFIX"
else
    [ "$CROSS_ARM"  = "y" ] && export arch_conf=ARM
    [ "$CROSS_SH4"  = "y" ] && export arch_conf=SH4

    source $goboSettings/Compile/Cross-$arch_conf.conf
    prefix="$crossPrefixDir"
fi

case "$1" in
    [sS]tart)
        mkdir -p $prefix/$goboStatus $prefix/$goboDevices
        [ ! -e $prefix/$goboStatus/self ]  && mount -o bind $goboStatus  $prefix/$goboStatus
        [ ! -e $prefix/$goboDevices/kmem ] && mount -o bind $goboDevices $prefix/$goboDevices
        ;;
    [sS]top)
        umount $prefix/$goboStatus 2> /dev/null     && echo "Unmounted binded proc filesystem"
        umount $prefix/$goboDevices 2> /dev/null    && echo "Unmounted binded dev filesystem"
        ;;
esac

true

#!/bin/sh

TOPDIR=..

source GoboPath
source ScriptFunctions
source $TOPDIR/.config
source $TOPDIR/functions/Platforms

if [ "$CROSS_NONE" = "y" ]
then 
    prefix="$INSTALL_PREFIX"
else
    export arch_conf=`get_chosen_arch`
    source $goboSettings/Compile/Cross-$arch_conf.conf
    prefix="$cross_prefix_dir"
fi

case "$1" in
    [sS]tart)
        mkdir -p $prefix/$goboStatus $prefix/$goboDevices
        [ ! -e $prefix/$goboStatus/self ]  && mount -o bind $goboStatus  $prefix/$goboStatus
        [ ! -e $prefix/$goboDevices/kmem ] && mount -o bind $goboDevices $prefix/$goboDevices
        ;;
    [sS]top)
        umount $prefix/$goboStatus 2> /dev/null     && echo "Unmounted binded proc filesystem"
        umount $prefix/$goboDevices 2> /dev/null    && echo "Unmounted binded dev filesystem"
        [ "$CROSS_NONE" != "y" ] && rm -Rf $TOPDIR/chroot/Area-*
        ;;
esac

true
